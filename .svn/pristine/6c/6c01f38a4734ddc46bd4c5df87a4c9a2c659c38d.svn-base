<?php
class Xmlrpc extends WE_Controller {
	var $methods;
	
	function __construct() {
		$this->methods = array (
				'we.addUser'=>'this:add_user'
		);
		parent::__construct ( $this->methods );
	}

	function add_user($args){
		
		$this->load->model('m_user');
		$this->load->helper('email');
		
		
		//根据email格式和其是否存在验证一个email是否可用
		if(valid_email($args[0])&&!$this->m_user->check_exist('email',$args[0]))
			$data['email']=$args[0];
		else return FALSE;
		
		//判断password是否可用
		if(preg_match("|^[a-zA-Z0-9]{6,20}$|", $args[1]))
			$data['password']=md5($args[1]);
		else return FALSE;
		
		//检查真实姓名是否已经存在
		if(preg_match("/^[\x{4e00}-\x{9fa5} a-zA-Z0-9]{2,10}+$/u", $args[2])){
			$num=$this->m_user->check_exist($args[2]);
			$data['real_name']=$args[2].'('.($num+1).')';
		}else return FALSE;
			
		$data['display_name']=$args[2];
		$data['create_time']=time();
		$data['last_activity']=time();
		
		return $this->m_user->add_user($data);
	}
	
}
?>