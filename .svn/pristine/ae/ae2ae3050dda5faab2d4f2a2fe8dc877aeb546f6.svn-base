<?php
class Xmlrpc extends WE_Controller {
	var $methods;
	
	function __construct() {
		$this->methods = array (
				'we.addUser'=>'this:add_user',
				'we.userLogin'=>'this:user_login'
		);
		parent::__construct ( $this->methods );
		
	}
	
	/**
	 * 增加新用户
	 * @param array $args
	 * @return boolean
	 */
	function add_user($args){
	
		$this->load->model('m_user');
		$data['email']=$args[0];
		$data['password']=$args[1];
		$data['real_name']=$args[2];
		$data['bluetooth_mac']=$args[3];
		return $this->m_user->add_user($data);
	}
	/**
	 * 用户登录，成功范围token，供下次使用
	 * @param array $args
	 * @return $token
	 */
	function user_login($args){
		$this->load->model('m_user');
		$this->load->driver('cache', array('adapter' => 'memcached', 'backup' => 'file'));
		$data['email']=$args[0];
		$data['password']=$args[1];
		$userdata=$this->m_user->validate_user($data);
		if($userdata)
			$token=md5(''.$data['email'].time());
		else return "invalid_userdata";
		$this->cache->save($token,serialize($userdata),300);
		return $token;
	}
	
	function update_state($args){
		
	}
	
}
?>